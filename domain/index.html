<!DOCTYPE html>
<html lang="zxx" class="no-js">
<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
			<link rel="shortcut icon" href="../img/fav.png">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Tantra Media - handpicked domains for you!</title>

	<link href="https://fonts.googleapis.com/css?family=Poppins:300,500,600,900" rel="stylesheet">
		<!--
		CSS
		============================================= -->
		<link rel="stylesheet" href="../css/linearicons.css">
		<link rel="stylesheet" href="../css/magnific-popup.css">
		<link rel="stylesheet" href="../css/bootstrap.css">
		<link rel="stylesheet" href="../css/main.css">


	</head>
	<body>

		<div class="main-wrapper-first relative">

<section class="subscription-area" style="border-bottom: 1px solid rgba(0, 0, 0, 0.125)">
				<div class="container">
					<div id="search" class="row justify-content-center">
						<div class="col-3 col-sm-3 col-md-3">
							<a href="../">
								<img class="img-fluid" src="../img/logo.png" alt="TANTRA MEDIA" />
							</a>
						</div>


						<div class="col-9 col-sm-8 col-md-8">
							<div id="mc_embed_signup">
								<form novalidate action="/domain" method="get" class="subscription relative">
									<input type="text" id="q" name="q" required>
									<button class="primary-btn" style="width: 8%; height: 90%;"><span style="font-size:1.5rem" class="lnr lnr-magnifier"></span></button>
									<div class="info"></div>
								</form>

							</div>
						</div>
					</div>

				</div>
			</section>

		<section class="story-area">
			<div class="container">

				<div class="row justify-content-md-center">
					<div class="col-md-8">
					<div class="alert alert-info" id="status-msg" role="alert">
						Howdy! Please wait while we process your request...
					</div>
					</div>
				</div>

				<div class="row justify-content-md-center" id="contact" style="display:none">

					<div class="col-md-6">

						<div class="card card-body bg-white text-center">

						<h3 class="card-title" id="domain-title">

						</h3>
							<p>

					  <del>
						<span style="font-size: 1.8em; font-weight: 200; color:lightgrey">$100</span>
					  </del>

						<span id="price" class="price" >

						</span>

							</p>
								<div id="paypal-button"></div>

						</div>
					</div>

				</div>
			</div>
		</section>




			<section class="featured-area text-center">
				<div class="container">

					<h5>
						How it works!
					</h5>

					<div class="row justify-content-md-center">
						<div class="col-md-3 col-sm-6 col-6">
								<div class="desc">
									<p><span style="font-size:1.2rem" class="lnr lnr-cart"></span> 1. Buy now with Paypal for a safe & easy experience</p>
								</div>
						</div>
						<div class="col-md-3 col-sm-6 col-6">
								<div class="desc">
									<p><span style="font-size:1.2rem" class="lnr lnr-envelope"></span> 2. Our support will guide with ownership transfer</p>
								</div>
						</div>
						<div class="col-md-3 col-sm-6 col-6">
								<div class="desc">
									<p><span style="font-size:1.2rem" class="lnr lnr-smile"></span> 3. Start using your new domain within 48 hours

									</p>
							</div>
						</div>

						<div class="col-md-4 col-sm-6 col-6">
									<p>
																<a href="../transact/">Learn more about our process
									</a>
									</p>
							</div>
						</div>

					</div>
			</section>
		</div>
		<div class="main-wrapper">



			<!-- Start footer Area -->
			<footer class="footer-area text-center">
				<div class="container">
				<div class="row">


						<div class="col-md-4 col-sm-6 col-6">
							<img class="img-fluid" src="../img/paypal.png" border="0" alt="PayPal Acceptance Mark">
						</div>


					<div class="col-md-4 col-sm-6 col-6">



					<div class="footer-menu">
							<a href="../transact/">Transact</a>
							<a href="../#about">About Us</a>
						</div>
						<div class="footer-social">
							<span class="lnr lnr-phone-handset"></span> +1650-2397232
							<br>
							<span class="lnr lnr-envelope"></span> info@tantra.me

						</div>
						</div>

					<div class="col-md-4 col-sm-12 col-12">
						<img class="img-fluid" src="../img/logo_footer.png" alt="TANTRA MEDIA" />
					<br>
					<br>

					 #108, 650 Castro St, Mountain View, CA


					</div>

				</div>
				</div>
			</footer>
			<!-- End footer Area -->
		</div>



<script src="https://www.paypalobjects.com/api/checkout.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1944294-8"></script>
  <script>
	//url = 'file:///home/ajf/AJF/ZZZZZZZZZZZZZ/projects/DMonkey/www/website/domain1/index.html'
	//api_url = 'http://localhost:5000'

	url = 'https://tantra.me'
	api_url = 'https://go.tantra.me'

	function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
    function(m,key,value) {
      vars[key] = value;
    });
    return vars;
  }



	async function fetchAsync (url) {
	  // await response of fetch call
	  let response = await fetch(url);
	  // only proceed once promise is resolved
	  let data = await response.json();
	  // only proceed once second promise is resolved
	  return data;
	}

	function handle_error(err) {
			console.log(err)
			document.getElementById("status-msg").innerHTML = 'Our server is down at the moment! Please try again later or contact <b>support@tantra.me</b>'
			document.getElementById("status-msg").className = 'alert alert-danger'
	}

	function payment_error() {
					document.getElementById("status-msg").innerHTML = 'You payment attempt has failed! Please try again later or contact <b>support@tantra.me</b>'
					document.getElementById("status-msg").className = 'alert alert-danger'

	}

	function handle_response(response) {
			if(response.hasOwnProperty('dn')) {

				if (typeof(Storage) !== "undefined") {
					window.localStorage.setItem('domain', response['dn']);
				}

				var params = getUrlVars();
				document.getElementById("domain-title").innerHTML = response['dn']
				document.getElementById("status-msg").innerHTML = "Great News! <b>" + response['dn'] + '</b> is for sale.'
				document.getElementById("status-msg").className = 'alert alert-success'
				document.getElementById("price").innerHTML = response['price']

    paypal.Button.render({

		locale: 'en_US',
		style: {
		 size: 'responsive',
		 color: 'blue',
		 shape: 'rect',
		 label: 'buynow',
		 tagline: 'true',
		 branding: 'true',
		},

        env: 'production', // Or 'sandbox'

        commit: true, // Show a 'Pay Now' button

        payment: function() {
            return paypal.request.post(api_url + '/payment-create', {
                item: response['dn']
            }).then(function(data) {
	            console.log(data);
                return data.i;
            }).catch(err => payment_error());
        },

        onAuthorize: function(data) {
	        console.log(data)
            return paypal.request.post(api_url + '/payment-execute', data).then(function(res) {
            	window.location.replace(url + "/transact/?q=" + res['id']);
                console.log(res)
            }).catch(err => payment_error());
        }

    }, '#paypal-button');

    				document.getElementById("contact").style.display = ""

				  window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'UA-1944294-8');



			} else {
				document.getElementById("status-msg").className = 'alert alert-warning'
				document.getElementById("status-msg").innerHTML = "We could not find any result matching your query <b>" + response['q'] + '</b>, please search again.'
			}
	}

	var params = getUrlVars();


	if(params.hasOwnProperty('q') && params['q'] != '') {
		document.getElementById("q").value = params['q'];
		fetchAsync(api_url + '/domain?q=' + params['q'])
				.then(data => handle_response(data))
				.catch(reason => handle_error(reason))
	} else {
		if (typeof(Storage) !== "undefined") {
			searched_domain = window.localStorage.getItem('domain');
			if (searched_domain !== "null") {
				document.getElementById("q").value = searched_domain;
			}
		}
		document.getElementById("status-msg").className = 'alert alert-warning'
		document.getElementById("status-msg").innerHTML = 'Please type a valid input while searching for a domain.'
	}
	</script>


		<script src="../js/vendor/jquery-2.2.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
		<script src="../js/vendor/bootstrap.min.js"></script>
		<script src="../js/main.js"></script>
	</body>
</html>
